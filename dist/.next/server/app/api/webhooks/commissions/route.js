"use strict";(()=>{var e={};e.id=3528,e.ids=[3528],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},71568:e=>{e.exports=require("zlib")},10223:(e,r,o)=>{o.r(r),o.d(r,{originalPathname:()=>f,patchFetch:()=>g,requestAsyncStorage:()=>l,routeModule:()=>m,serverHooks:()=>_,staticGenerationAsyncStorage:()=>x});var t={};o.r(t),o.d(t,{POST:()=>d});var s=o(49303),i=o(88716),n=o(60670),a=o(87070),u=o(69498);let p=require("node:crypto");var c=o.n(p);async function d(e){let r=process.env.COMMISSIONS_WEBHOOK_SECRET||"",o=e.headers.get("x-signature")||"",t=await e.text();if(!r||!o||!function(e,r,o){let t=c().createHmac("sha256",o).update(e).digest("hex");return c().timingSafeEqual(Buffer.from(t),Buffer.from(r))}(t,o,r))return a.NextResponse.json({ok:!1,error:"bad signature"},{status:401});let s=JSON.parse(t),i=(0,u.eI)("https://wpkcawjvhnaykqjgcgye.supabase.co",process.env.SUPABASE_SERVICE_ROLE),{data:n}=await i.from("providers").select("id").eq("slug",s.provider_slug).single();if(!n)return a.NextResponse.json({ok:!1,error:"provider not found"},{status:400});let p={provider_id:n.id,external_conversion_id:String(s.conversion_id),clickout_id:s.clickout_id??null,offer_id:s.offer_id??null,gross_amount:Number(s.gross_amount||0),commission_amount:Number(s.commission_amount||0),currency:s.currency||"EUR",status:s.status||"pending",occurred_at:s.occurred_at?new Date(s.occurred_at).toISOString():null},{error:d}=await i.from("commissions").upsert(p,{onConflict:"provider_id,external_conversion_id"});return d?a.NextResponse.json({ok:!1,error:d.message},{status:500}):a.NextResponse.json({ok:!0})}let m=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/webhooks/commissions/route",pathname:"/api/webhooks/commissions",filename:"route",bundlePath:"app/api/webhooks/commissions/route"},resolvedPagePath:"/Users/cenkyakinlar/Documents/Dokumentit â€“ CenkAir - MacBook Air/DREAMWEAVER/FOODAI/app/api/webhooks/commissions/route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:l,staticGenerationAsyncStorage:x,serverHooks:_}=m,f="/api/webhooks/commissions/route";function g(){return(0,n.patchFetch)({serverHooks:_,staticGenerationAsyncStorage:x})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var o=e=>r(r.s=e),t=r.X(0,[8948,5206,5972],()=>o(10223));module.exports=t})();